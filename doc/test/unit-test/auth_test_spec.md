# 認証機能テスト仕様書

## 概要
このテスト仕様書は、IdeaTubeアプリケーションの認証機能に関する単体テストの内容を定義します。

## テスト対象機能
- メールアドレス認証サインアップ（AUTH-01）
- メールアドレス認証ログイン（AUTH-02）
- Google認証ログイン（AUTH-03）
- ログアウト（AUTH-04）
- パスワードリセット（リクエスト）（AUTH-05）
- パスワードリセット（実行）（AUTH-06）
- メール確認（AUTH-07）

## テスト仕様

### AUTH-01: メールアドレス認証サインアップ

| テストID | テスト内容 | 入力値 | 期待される結果 | 前提条件 |
|---------|-----------|--------|--------------|---------|
| AUTH-01-01 | 有効なメールアドレスとパスワードでサインアップ | メール: valid@example.com<br>パスワード: ValidPass123 | 登録成功、確認メール送信、プロフィール自動作成 | - |
| AUTH-01-02 | 既存メールアドレスでサインアップ | メール: existing@example.com<br>パスワード: ValidPass123 | エラーメッセージ表示（既に登録済み） | 既存ユーザーが存在する |
| AUTH-01-03 | 無効なメールアドレスでサインアップ | メール: invalid-email<br>パスワード: ValidPass123 | エラーメッセージ表示（無効なメールアドレス） | - |
| AUTH-01-04 | 弱いパスワードでサインアップ | メール: valid@example.com<br>パスワード: weak | エラーメッセージ表示（パスワード要件不足） | - |
| AUTH-01-05 | 空のメールアドレスでサインアップ | メール: (空)<br>パスワード: ValidPass123 | エラーメッセージ表示（メールアドレス必須） | - |
| AUTH-01-06 | 空のパスワードでサインアップ | メール: valid@example.com<br>パスワード: (空) | エラーメッセージ表示（パスワード必須） | - |

### AUTH-02: メールアドレス認証ログイン

| テストID | テスト内容 | 入力値 | 期待される結果 | 前提条件 |
|---------|-----------|--------|--------------|---------|
| AUTH-02-01 | 有効なメールアドレスとパスワードでログイン | メール: valid@example.com<br>パスワード: ValidPass123 | ログイン成功、ダッシュボード表示 | 登録済みユーザー |
| AUTH-02-02 | 無効なメールアドレスでログイン | メール: nonexistent@example.com<br>パスワード: ValidPass123 | エラーメッセージ表示（無効な認証情報） | - |
| AUTH-02-03 | 無効なパスワードでログイン | メール: valid@example.com<br>パスワード: WrongPass123 | エラーメッセージ表示（無効な認証情報） | 登録済みユーザー |
| AUTH-02-04 | 未確認のメールアドレスでログイン | メール: unconfirmed@example.com<br>パスワード: ValidPass123 | エラーメッセージ表示（メール未確認） | 未確認メールの登録済みユーザー |
| AUTH-02-05 | 空のメールアドレスでログイン | メール: (空)<br>パスワード: ValidPass123 | エラーメッセージ表示（メールアドレス必須） | - |
| AUTH-02-06 | 空のパスワードでログイン | メール: valid@example.com<br>パスワード: (空) | エラーメッセージ表示（パスワード必須） | - |

### AUTH-03: Google認証ログイン

| テストID | テスト内容 | 入力値 | 期待される結果 | 前提条件 |
|---------|-----------|--------|--------------|---------|
| AUTH-03-01 | 初回Google認証でのサインアップ | Googleアカウント | ログイン成功、プロフィール自動作成、ダッシュボード表示 | 未登録Googleアカウント |
| AUTH-03-02 | 既存Google認証でのログイン | Googleアカウント | ログイン成功、ダッシュボード表示 | 登録済みGoogleアカウント |
| AUTH-03-03 | メールアドレス登録済みのGoogleアカウントでログイン | Googleアカウント | アカウント連携の選択肢提示 | メールアドレスのみで登録済みのユーザー |
| AUTH-03-04 | 認証キャンセル | Googleポップアップでキャンセル | 認証プロセス終了、ログイン画面表示 | - |
| AUTH-03-05 | Google認証エラー | エラー状態のGoogleアカウント | エラーメッセージ表示 | - |

### AUTH-04: ログアウト

| テストID | テスト内容 | 入力値 | 期待される結果 | 前提条件 |
|---------|-----------|--------|--------------|---------|
| AUTH-04-01 | ログアウト実行 | ログアウトボタンクリック | ログアウト成功、ログイン画面表示 | ログイン済みユーザー |
| AUTH-04-02 | 複数デバイスでのログアウト | ログアウトボタンクリック | 現在のデバイスのみでログアウト | 複数デバイスでログイン済み |
| AUTH-04-03 | セッション期限切れ後のログアウト | ログアウトボタンクリック | エラーなしでログアウト処理、ログイン画面表示 | セッション期限切れ状態 |

### AUTH-05: パスワードリセット（リクエスト）

| テストID | テスト内容 | 入力値 | 期待される結果 | 前提条件 |
|---------|-----------|--------|--------------|---------|
| AUTH-05-01 | 有効なメールアドレスでパスワードリセット | メール: valid@example.com | 成功メッセージ、リセットメール送信 | 登録済みユーザー |
| AUTH-05-02 | 未登録メールアドレスでパスワードリセット | メール: nonexistent@example.com | 成功メッセージ（セキュリティのため）、メール送信なし | - |
| AUTH-05-03 | 無効なメールアドレス形式でパスワードリセット | メール: invalid-email | エラーメッセージ表示（無効なメールアドレス） | - |
| AUTH-05-04 | 空のメールアドレスでパスワードリセット | メール: (空) | エラーメッセージ表示（メールアドレス必須） | - |
| AUTH-05-05 | 連続パスワードリセットリクエスト | メール: valid@example.com（短時間に複数回） | レート制限メッセージ表示 | 登録済みユーザー |

### AUTH-06: パスワードリセット（実行）

| テストID | テスト内容 | 入力値 | 期待される結果 | 前提条件 |
|---------|-----------|--------|--------------|---------|
| AUTH-06-01 | 有効なトークンで新パスワード設定 | パスワード: NewPass123<br>確認: NewPass123 | パスワード更新成功、ログイン画面表示 | 有効なリセットトークン |
| AUTH-06-02 | パスワードと確認パスワードの不一致 | パスワード: NewPass123<br>確認: DiffPass123 | エラーメッセージ表示（パスワード不一致） | 有効なリセットトークン |
| AUTH-06-03 | 弱いパスワードでリセット | パスワード: weak<br>確認: weak | エラーメッセージ表示（パスワード要件不足） | 有効なリセットトークン |
| AUTH-06-04 | 期限切れトークンでパスワードリセット | パスワード: NewPass123<br>確認: NewPass123 | エラーメッセージ表示（期限切れリンク） | 期限切れリセットトークン |
| AUTH-06-05 | 無効なトークンでパスワードリセット | パスワード: NewPass123<br>確認: NewPass123 | エラーメッセージ表示（無効なリンク） | 無効なリセットトークン |
| AUTH-06-06 | 空のパスワードでリセット | パスワード: (空)<br>確認: (空) | エラーメッセージ表示（パスワード必須） | 有効なリセットトークン |

### AUTH-07: メール確認

| テストID | テスト内容 | 入力値 | 期待される結果 | 前提条件 |
|---------|-----------|--------|--------------|---------|
| AUTH-07-01 | 有効な確認トークンでメール確認 | 確認リンククリック | 確認成功、ログイン画面表示 | 未確認メール、有効なトークン |
| AUTH-07-02 | 期限切れ確認トークンでメール確認 | 確認リンククリック | エラーメッセージ表示（期限切れリンク） | 未確認メール、期限切れトークン |
| AUTH-07-03 | 無効な確認トークンでメール確認 | 確認リンククリック | エラーメッセージ表示（無効なリンク） | 無効なトークン |
| AUTH-07-04 | 既に確認済みのメールで確認 | 確認リンククリック | 情報メッセージ表示（既に確認済み） | 確認済みメール、有効なトークン |
| AUTH-07-05 | 確認メールの再送信 | 再送信ボタンクリック | 成功メッセージ、新しい確認メール送信 | 未確認メールの登録済みユーザー |

## 特記事項
- パスワードは最低8文字以上で、1つ以上の大文字、小文字、数字を含む必要がある
- メール確認とパスワードリセットのトークンは24時間で期限切れとなる
- セキュリティ上の理由から、存在しないメールアドレスへのパスワードリセットリクエストも成功メッセージを表示する
- Google認証のテストは実際のGoogleアカウントとの連携が必要 