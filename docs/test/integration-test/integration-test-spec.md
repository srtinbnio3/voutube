# IdeaTube 結合テスト仕様書

## 1. 概要

このドキュメントでは、IdeaTubeアプリケーションの結合テストの仕様を定義します。結合テストは、複数のコンポーネントやモジュール間の相互作用を検証し、機能要件が正しく実装されていることを確認します。

## 2. テスト環境

### 2.1 テストツール
- Vitest: テストランナーとアサーション
- @testing-library/react: コンポーネントのレンダリングとインタラクション
- MSW (Mock Service Worker): APIモック
- @testing-library/user-event: ユーザーイベントのシミュレーション

### 2.2 テストデータ
- テスト用データベース（Supabase）
- モックYouTube APIレスポンス
- テストユーザーアカウント

## 3. テストケース

### 3.1 認証フロー (AUTH)

#### TC-AUTH-001: サインアップからプロフィール作成まで
**前提条件**
- アプリケーションが初期状態
- テストメールアドレスが未登録

**テストステップ**
1. サインアップフォームを表示
2. メールアドレスとパスワードを入力
3. サインアップを実行
4. メール確認プロセスを完了
5. プロフィールの自動作成を確認

**期待結果**
- ユーザーアカウントが作成される
- プロフィールが自動的に作成される
- ダッシュボードにリダイレクトされる

#### TC-AUTH-002: ログイン・ログアウトフロー
**前提条件**
- 既存のテストユーザーアカウント

**テストステップ**
1. ログインフォームを表示
2. 認証情報を入力
3. ログインを実行
4. ログアウトを実行

**期待結果**
- ログイン後にダッシュボードが表示される
- ログアウト後にホームページにリダイレクトされる

### 3.2 チャンネル管理 (CHAN)

#### TC-CHAN-001: チャンネル検索と追加
**前提条件**
- ログイン済みユーザー
- 有効なYouTubeチャンネルID

**テストステップ**
1. チャンネル検索フォームを表示
2. チャンネルIDを入力
3. 検索を実行
4. チャンネル情報の表示を確認
5. チャンネルの追加を実行

**期待結果**
- チャンネル情報が正しく取得される
- データベースにチャンネルが保存される
- チャンネル一覧に新しいチャンネルが表示される

#### TC-CHAN-002: チャンネル一覧のソート
**前提条件**
- 複数のチャンネルが登録済み
- 各チャンネルに投稿が存在

**テストステップ**
1. チャンネル一覧を表示
2. 投稿数でソート
3. 最新投稿日時でソート

**期待結果**
- 選択したソート条件に従ってチャンネルが並び替えられる
- ソート後も正しいチャンネル情報が表示される

### 3.3 投稿管理 (POST)

#### TC-POST-001: 新規投稿作成
**前提条件**
- ログイン済みユーザー
- 既存のチャンネル

**テストステップ**
1. チャンネル詳細ページを表示
2. 新規投稿フォームを開く
3. タイトルと本文を入力
4. 投稿を作成

**期待結果**
- 投稿がデータベースに保存される
- チャンネルの投稿一覧に新しい投稿が表示される
- チャンネルの統計情報が更新される

#### TC-POST-002: 投稿のソートと表示
**前提条件**
- 複数の投稿が存在
- 投票データが存在

**テストステップ**
1. 投稿一覧を表示
2. 人気順でソート
3. 新着順でソート

**期待結果**
- 選択したソート条件に従って投稿が並び替えられる
- 各投稿の情報（タイトル、投票数、作成日時）が正しく表示される

### 3.4 投票システム (VOTE)

#### TC-VOTE-001: 投票フロー
**前提条件**
- ログイン済みユーザー
- 既存の投稿

**テストステップ**
1. 投稿を表示
2. いいね投票を実行
3. 投票の取り消しを実行
4. よくないね投票を実行
5. いいねに切り替え

**期待結果**
- 投票状態が正しく更新される
- 投票スコアが正しく計算される
- UIが投票状態を正しく反映する

### 3.5 プロフィール機能 (PROF)

#### TC-PROF-001: プロフィール表示
**前提条件**
- 既存のユーザーアカウント
- プロフィールデータ

**テストステップ**
1. ユーザーの投稿を表示
2. プロフィール情報を確認

**期待結果**
- ユーザー名が正しく表示される
- アバター画像が正しく表示される

## 4. テスト実行環境の設定

### 4.1 テストデータベースの準備
```typescript
// テストデータベースのセットアップ
beforeAll(async () => {
  // テストDB初期化
  await setupTestDatabase()
  // 初期データ投入
  await seedTestData()
})

// テストデータのクリーンアップ
afterAll(async () => {
  await cleanupTestDatabase()
})
```

### 4.2 APIモックの設定
```typescript
// YouTube API モック
const mockYouTubeAPI = setupMockYouTubeAPI()

// Supabase APIモック
const mockSupabaseAPI = setupMockSupabaseAPI()
```

## 5. テスト実装ガイドライン

### 5.1 コンポーネント間の結合テスト
```typescript
describe('AuthWizard and Profile Integration', () => {
  it('creates profile after successful signup', async () => {
    render(
      <AuthContext>
        <AuthWizard />
        <ProfileDisplay />
      </AuthContext>
    )
    // テストステップの実装
  })
})
```

### 5.2 データフロー検証
```typescript
describe('Post and Vote Integration', () => {
  it('updates post score after voting', async () => {
    render(
      <PostContext>
        <PostDisplay />
        <VoteButtons />
      </PostContext>
    )
    // テストステップの実装
  })
})
```

## 6. 注意事項

### 6.1 テストの独立性
- 各テストケースは独立して実行可能であること
- テストデータは各テスト実行前に初期化すること
- グローバルな状態に依存しないこと

### 6.2 非同期処理
- データベース操作の完了を適切に待機
- API呼び出しのレスポンスを適切に処理
- ユーザーインタラクションの完了を確認

### 6.3 エラーケース
- ネットワークエラーのハンドリング
- バリデーションエラーの検証
- 権限エラーの確認

## 7. 実行計画

### 7.1 実行順序
1. 認証関連テスト
2. チャンネル管理テスト
3. 投稿管理テスト
4. 投票システムテスト
5. プロフィール機能テスト

### 7.2 実行環境
- CI/CD パイプラインでの自動実行
- プルリクエスト時の自動テスト実行
- 定期的な結合テストの実行

## 8. メンテナンス

### 8.1 テストケースの更新
- 新機能追加時のテストケース追加
- 既存機能変更時のテストケース更新
- 非推奨機能のテストケース削除

### 8.2 テストコードの品質管理
- テストコードのレビュー実施
- テストカバレッジの監視
- テストパフォーマンスの最適化

---

このテスト仕様書は、アプリケーションの変更に応じて継続的に更新されます。 